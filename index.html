<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Soporte T√©cnico SIIT - SUNAFIL</title>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="app-container">
        
        <header class="header">
            <div class="header-brand">
                <h1>SUNAFIL - Soporte T√©cnico SIIT</h1>
                <small>SDAN-DINI <p>Desarrollado por el Equipo de IA & CIENCIA DE DATOS</p></small>
            </div>
            <div class="status-badge">
                <span class="status-dot"></span> CONEXI√ìN SEGURA DLP
            </div>
        </header>

        <main class="chat-area" id="chatBox">
            <div class="message bot">
                <strong>Asistente Virtual SIIT</strong><br>
                Bienvenido. El protocolo de <b>Protecci√≥n de Datos (DLP)</b> est√° activo.<br>
                Los datos sensibles (DNI, RUC, etc) ser√°n anonimizados autom√°ticamente.
                <span class="bot-signature">Soporte SDAN-DINI</span>
            </div>
        </main>

        <div class="typing-indicator" id="loader">
            <span style="display:inline-block; animation: spin 1s infinite">üõ°Ô∏è</span> Consultando base de datos...
        </div>

        <footer class="input-area">
            <div class="input-wrapper">
                <input type="text" id="userInput" placeholder="Escriba su consulta t√©cnica aqu√≠..." autocomplete="off">
                <button id="sendBtn" onclick="handleSend()">ENVIAR</button>
            </div>
        </footer>

        <div class="footer-legal">
            Ley N.¬∞ 29733 ‚Äì Ley de Protecci√≥n de Datos Personales  | Modelo llama-3.3-70b-versatile
        </div>

    </div>

    <script src="script.js"></script>

    <script>
        const chatArea = document.getElementById('chatBox');
        
        // Sobrescribimos la funci√≥n para aplicar las clases del nuevo CSS
        window.addMessage = function(htmlContent, senderType) {
            const div = document.createElement('div');
            div.className = `message ${senderType}`; // Aplica clase .bot o .user
            div.innerHTML = htmlContent;

            // Firma autom√°tica solo para el bot
            if (senderType === 'bot' && !htmlContent.includes("Error")) {
                div.innerHTML += '<span class="bot-signature">Soporte SIIT</span>';
            }

            chatArea.appendChild(div);
            chatArea.scrollTop = chatArea.scrollHeight; // Auto-scroll
        };
    </script>

    <script>
    (function(){
        window.addEventListener('load', function() {
            // fetch('http://localhost:5000/api/registrar-visita')
            fetch('https://lim-cpu2nvx.tail9bc556.ts.net/api/registrar-visita')
                .then(() => console.log('üì° Telemetr√≠a SIIT: Conectada'))
                .catch(err => console.warn('‚ö†Ô∏è Telemetr√≠a Offline'));
        });
    })();
    </script>

</body>
</html>